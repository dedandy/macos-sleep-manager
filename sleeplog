#!/bin/bash
# ~/.sleeplog - Dashboard v4.2
LOG_FILE="$HOME/.sleeplog_history"

show_help() {
    echo -e "\033[1;36mOPZIONI DISPONIBILI:\033[0m"
    echo -e "  \033[1;33msleeplog\033[0m          - Mostra l'ultima attività (Dashboard)"
    echo -e "  \033[1;33msleeplog all\033[0m      - Mostra l'intero storico"
    echo -e "  \033[1;33msleeplog recent 20\033[0m - Ultime 20 righe"
    echo -e "  \033[1;33msleeplog clear\033[0m     - Svuota i log"
}

case "$1" in
    help|--help|-h) show_help; exit 0 ;;
    all) cat "$LOG_FILE"; exit 0 ;;
    recent) tail -n "${2:-20}" "$LOG_FILE"; exit 0 ;;
    clear) echo "==== LOG RESETTATO IL $(date) ====" > "$LOG_FILE"; echo "Log svuotato."; exit 0 ;;
esac

echo -e "\033[1;36m╔════════════════════════════════════════╗\033[0m"
echo -e "\033[1;36m║       macOS SLEEP MANAGER STATUS       ║\033[0m"
echo -e "\033[1;36m╚════════════════════════════════════════╝\033[0m"

if [ ! -f "$LOG_FILE" ]; then echo "Nessun dato."; exit 0; fi

# Dashboard: mostra solo l'ultimo evento
tail -r "$LOG_FILE" | awk '/====/{if(p)exit;p=1}p' | tail -r | sed 's/====//g'
echo -e "\033[0;90m------------------------------------------\033[0m"
echo -e "\033[0;90mDigita 'sleeplog help' per altre opzioni\033[0m"